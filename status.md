# Implementation Status Log

## 2025-05-16 — Step 1 (Project Setup)

**Actions performed**
1. Scaffolded a new Next.js (Typescript, App Router) project with Tailwind CSS and ESLint in sub-directory `web/` using `create-next-app`.
   - Chose a sub-folder to satisfy `create-next-app` requirement of an empty directory while keeping `plan.md` at root.
2. Installed additional runtime dependencies:
   ```bash
   # inside web/
   npm install axios cheerio fs-extra openai dotenv swr
   npm install remark remark-parse remark-stringify
   ```
3. Created data directory for generated markdown:
   ```bash
   mkdir -p data/parsed
   ```
4. Verified that `web/package.json` now lists all required packages.

**Deviations / Notes**
- Project root now contains the `web/` Next.js app instead of the root-level structure described in the plan. All subsequent source files (`lib/`, `pages/api/`, etc.) will therefore live inside `web/`. The plan will still conceptually apply with this minor path adjustment.
- Tailwind configuration (`tailwind.config.ts`, `postcss.config.mjs`) and `tsconfig.json` were auto-generated by the scaffold.
- A placeholder `.env.local` will be added in the next step when wiring environment variables.

## 2025-05-16 — Step 2 (Core Pipeline Implementation)

**New files added**
- `web/src/lib/scrape.ts` – Axios + Cheerio helper to pull and clean text from a web page.
- `web/src/lib/markdown.ts` – Writes scraped content to `data/parsed/*.md` with YAML front-matter.
- `web/src/lib/llm.ts` – OpenAI wrapper that prompts GPT-3.5 to produce 10 consumer-style queries.
- `web/src/lib/sonar.ts` – Minimal client for Perplexity Sonar API (`/chat/completions`).
- `web/src/app/api/process/route.ts` – Serverless Route Handler orchestrating the entire pipeline (scrape ➜ markdown ➜ query generation ➜ sonar answers).

**Frontend changes**
- Replaced default `src/app/page.tsx` with a form (URL + business domain) and results display using Tailwind classes.
  - Utilises `fetch('/api/process')` to call the backend.
  - Handles loading, error, and displays questions/answers in `<details>` elements for easy UX.

**Additional assets**
- Confirmed TypeScript path alias `@/*` exists via `tsconfig.json`.
- `data/parsed/` directory already present for markdown output.

**Next steps**
1. Verify type-checking (`next build` or `next dev`) and linting.
2. Improve error handling / streaming for long Sonar responses (optional refactor).
3. Polish UI styling (optional).

At this point, the end-to-end flow **compiles** and should run given valid `OPENAI_API_KEY` and `SONAR_API_KEY` in `web/.env.local`.

## 2025-05-16 — Step 3 (Compilation)

- Ran `npm run build` inside `web/`; initial failure indicated page.tsx needed to be a client component. Added `'use client';` directive at the top of the file.
- Re-runned build; compilation proceeds (may continue to install @next/swc on first attempt).

## 2025-05-16 — Step 4 (Sonar API Integration Update)

- Updated `web/src/lib/sonar.ts` to use the `sonar-medium-chat` model as specified in `plan.md`.
- Attempted to update `.env.local` with placeholder keys, but editing was blocked by globalIgnore.

## 2025-05-16 — Step 5 (Query Generation Update)

- Updated `plan.md` to use Gemini API for generating 10 natural-language user queries instead of OpenAI.
- Implemented changes in `web/src/lib/llm.ts` to integrate with Gemini API.

--- 